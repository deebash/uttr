<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uttr: Simple and Fast Sticky Notes app</title>
    <meta name="description" content="Utter Simple and fast sticky notes app with sharing across multiple platforms and accounts">
    <meta name="keywords" content="">
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="select.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link href="https://fonts.googleapis.com/css?family=Crete+Round|Fjalla+One|PT+Sans&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.pink-indigo.min.css" /> 
	<link rel="stylesheet" href="te.css" /> 
	<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
	<script type="text/javascript" src="select.js" charset="UTF-8"></script>
	<script type="text/javascript" src="jquery.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="te.js" charset="utf-8"></script>
	<script type="text/javascript" src="moment.min.js" charset="utf-8"></script>	
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

  </head>
    <style>
    #create-note-btn {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
	*{
	font-family: 'PT Sans', serif;
	}
    </style>
  <body>
  
  <body>
    <div class="uttr-layout mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header">
      <header class="uttr-header mdl-layout__header mdl-color--teal-600 mdl-color-text--white-600">
        <div class="mdl-layout__header-row">
		  <button id="boardRenameBtn" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored mdl-color-text--white">											
				<i class="material-icons" role="presentation">edit</i>
				<span class="visuallyhidden">Rename</span>
		  </button> &nbsp; <span class="mdl-layout-title" id="currentBoardName">Board 1</span><span class="mdl-layout-title" id="searchTitle" style="display:none">Search ""</span>
          <div class="mdl-layout-spacer"></div>
          <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable" id="searchBar" style="display:none">
            <label class="mdl-button mdl-js-button mdl-button--icon" for="search">
              <i class="material-icons">search</i>
            </label>
            <div class="mdl-textfield__expandable-holder">
              <input class="mdl-textfield__input" type="text" id="search">
              <label class="mdl-textfield__label" for="search">Search your notes...</label>
            </div>
          </div>
		   <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" id="hdrbtn">
            <i class="material-icons">more_vert</i>
          </button>
          <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right" for="hdrbtn">          
            <li class="mdl-menu__item" style="display:none">Share</li>
            <li class="mdl-menu__item" id="delete-board-btn">Delete Board</li>
            
          </ul>
        </div>
      </header>
      <div class="uttr-drawer mdl-layout__drawer mdl-color--teal-700 mdl-color-text--white">
        <header class="uttr-drawer-header" id="uttr-drawer-header-div">
		  <span style="font-size:30px;font-family:Crete" class="tooltip" title="Simple and fast sticky Notes App">Uttr.</span></br><center>
		  <button class="uttr-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white" id="open-board-btn">
				Open Board
		  </button>
		  <button class="uttr-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white" id="save-board-btn">
				Save Board
		  </button>
		</center>
          <div class="uttr-avatar-dropdown">
            <span id="author-name">anonymous</span>
			<div class="mdl-layout-spacer"></div>
            <button id="accbtn" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
              <i class="material-icons" role="presentation">arrow_drop_down</i>
              <span class="visuallyhidden">Accounts</span>
			</button>
		
            <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="accbtn">
              <li class="mdl-menu__item" id="themeBtn" style="display:none"><i class="material-icons">format_paint</i>&nbsp; Appearance</li>
              <li class="mdl-menu__item" id="settingsBtn" style="display:none"><i class="material-icons">build</i>&nbsp; Settings</li>
              <li class="mdl-menu__item" id="signInBtn" style="display:none" onclick="signIn()"><i class="material-icons">power_settings_new</i>&nbsp; Sign In</li>
              <li class="mdl-menu__item" id="signOutBtn" style="display:none" onclick="signOut()"><i class="material-icons">power_settings_new</i>&nbsp; Sign Out</li>
            </ul>
		  </div>
        </header>
        <nav style="padding-top: 0px;" class="uttr-navigation mdl-navigation mdl-color--teal-700 mdl-color-text--white">
          <div class="mdl-navigation__link" id="create-board-btn" style="display:none"><i class="mdl-color-text--white-800 material-icons" role="presentation">add</i>Create Board</div>         
			<div id="boardList">
				         
          	</div>
		  <div class="mdl-layout-spacer"></div>
          <div class="mdl-navigation__link" id="moreAboutBtn"><i class="mdl-color-text--hite-white-400 material-icons" role="presentation">help_outline</i><span class="">More about Uttr.</span></div>
        </nav>
      </div>
      <main class="mdl-layout__content mdl-color--teal-600">
			<div id="loader" style="display:none" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
        <div class="mdl-grid uttr-content" >

          <div id="uttr-content" class="uttr-cards mdl-cell mdl-cell--4-col mdl-cell--8-col-tablet mdl-cell--12-col-desktop mdl-grid mdl-grid--no-spacing">
		  
				
	
          </div>
        </div>
      </main>
    </div>
	
	<dialog class="mdl-dialog" id="create-board-dialog">
		<h4 class="mdl-dialog__title">New board</h4>
		<div class="mdl-dialog__content">
		   <div class="mdl-textfield mdl-js-textfield">
				<input class="mdl-textfield__input" type="text" id="boardName">
				<label class="mdl-textfield__label" for="sample1">Enter board name...</label>
			</div>
		</div>
		<div class="mdl-dialog__actions">
		  <button type="button" id="create-board-create-btn" class="mdl-button">Create</button>
		  <button type="button" id="create-board-close-btn" class="mdl-button close">Cancel</button>
		</div>
	</dialog>
	
	<dialog class="mdl-dialog" id="save-board-dialog">
		<h4 class="mdl-dialog__title" style="font-size: 1.5rem;">Save Anonymous Board</h4>
		<div class="mdl-dialog__content">
		   <div class="mdl-textfield mdl-js-textfield">
				<input class="mdl-textfield__input" type="text" id="urlName">
				<label class="mdl-textfield__label" for="sample1">Enter unique URL for board...</label>
			</div>
			<p>You can access the board via: https://uttr.in/?b=<span id="yoururlhere">&lt; unique URL &gt;</span></p></br>
			<p style="color:red">Note: Saving anonymous board is not recommended. Anyone can modify or delete your board if they know your url.</p>
		</div>
		<div class="mdl-dialog__actions">
		  <button type="button" id="save-board-save-btn" class="mdl-button">Save</button>
		  <button type="button" id="save-board-close-btn" class="mdl-button close">Cancel</button>
		</div>
	</dialog>

	<dialog class="mdl-dialog" id="open-board-dialog">
		<h4 class="mdl-dialog__title" style="font-size: 1.5rem;">Open Anonymous Board</h4>
		<div class="mdl-dialog__content">
			<p id="toOpenURL">https://uttr.in/?b=&lt;unique URL&gt;</p>
		    <div class="mdl-textfield mdl-js-textfield">
				<input class="mdl-textfield__input" type="text" id="openurlName">
				<label class="mdl-textfield__label" for="sample1">Enter unique URL of board</label>
			</div>
			</div>
		<div class="mdl-dialog__actions">
		  <button type="button" id="open-board-open-btn" class="mdl-button">Open</button>
		  <button type="button" id="open-board-close-btn" class="mdl-button close">Cancel</button>
		</div>
	</dialog>
	
	<dialog class="mdl-dialog" id="create-note-dialog">
		<h4 class="mdl-dialog__title">New Note</h4>
		<div class="mdl-dialog__content">
		    <div class="mdl-textfield mdl-js-textfield new-note">
				<input class="mdl-textfield__input" type="text" id="noteTitleTxt">
				<label class="mdl-textfield__label" for="noteTitleTxt">Title...</label>
			</div>			
			<div class="mdl-textfield mdl-js-textfield new-note">
				<textarea class="mdl-textfield__input editor" type="text" rows= "3" id="noteContentTxt" ></textarea>
			</div>
			<div class="mdl-textfield mdl-js-textfield getmdl-select" id="newColorMDLSelect">
					<input type="text" value="" class="mdl-textfield__input" id="noteColor" readonly>
					<input type="hidden" value="" name="noteColor">
					<ul for="noteColor" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">
						<li class="mdl-menu__item new-note-color-item" data-val="yellow">Yellow</li>
						<li class="mdl-menu__item new-note-color-item" data-val="red">Red</li>
						<li class="mdl-menu__item new-note-color-item" data-val="blue">Blue</li>
						<li class="mdl-menu__item new-note-color-item" data-val="violet">Violet</li>
						<li class="mdl-menu__item new-note-color-item" data-val="green">Green</li>
						
					</ul>
			</div>
		</div>
		<div class="mdl-dialog__actions">
		  <button type="button" id="create-note-create-btn" class="mdl-button">Create</button>
		  <button type="button" id="create-note-close-btn" class="mdl-button close">Cancel</button>
		</div>
	</dialog>

	<dialog class="mdl-dialog" id="edit-dialog">
		<h4 class="mdl-dialog__title">Edit Note</h4>
		<div class="mdl-dialog__content">
		   <div class="mdl-textfield mdl-js-textfield edit-note">
				<input class="mdl-textfield__input" type="text" id="editNoteTitleTxt">
				
			</div>
			<p id="note-meta"></p>
			<div class="mdl-textfield mdl-js-textfield edit-note" style="padding-top:0px;">
				<textarea class="mdl-textfield__input editor" type="text" rows= "6" id="editNoteContentTxt" ></textarea>
				
			</div>

			<div class="mdl-textfield mdl-js-textfield getmdl-select" style="padding:0px;" id="editColorMDLSelect">
					<input type="text" value="" class="mdl-textfield__input" id="editNoteColor" readonly>
					<input type="hidden" value="" id="editNoteColorTxt" name="editNoteColor">					
					<ul for="editNoteColor" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">
						<li class="mdl-menu__item note-color-item" data-val="yellow">Yellow</li>
						<li class="mdl-menu__item note-color-item" data-val="red">Red</li>
						<li class="mdl-menu__item note-color-item" data-val="blue">Blue</li>
						<li class="mdl-menu__item note-color-item" data-val="violet">Violet</li>
						<li class="mdl-menu__item note-color-item" data-val="green">Green</li>
						<li class="mdl-menu__item note-color-item" data-val="white">White</li>
						
					</ul>
			</div>

		</div>

		<div class="mdl-dialog__actions">	  
		  <button type="button" id="edit-delete-btn" class="mdl-button delete">Delete Note</button>
		  <button type="button" id="edit-cancel-btn" class="mdl-button close">Cancel</button>
		  <button type="button" id="edit-save-btn" class="mdl-button">Save</button>
		</div>
	</dialog>

	<dialog class="mdl-dialog" id="rename-board-dialog">
		<h4 class="mdl-dialog__title">Board Name</h4>
		<div class="mdl-dialog__content">
		   <div class="mdl-textfield mdl-js-textfield">
				<input class="mdl-textfield__input" type="text" id="boardNameTxt">					
			</div>				
		</div>
		<div class="mdl-dialog__actions">
		  <button type="button" id="rename-board-rename-btn" class="mdl-button">Rename</button>
		  <button type="button" id="rename-board-close-btn" class="mdl-button close">Cancel</button>
		</div>
	</dialog>


	<dialog class="mdl-dialog" id="board-saved-msg-dialog">
		<h4 class="mdl-dialog__title" id="board-saved-msg-title"></h4>
		<div class="mdl-dialog__content">
		   <div class="mdl-textfield mdl-js-textfield">
			<p id="board-saved-msg-content"></p>	
			</div>
		</div>
		<div class="mdl-dialog__actions">
		  <button id="board-saved-msg-close" type="button" class="mdl-button">Ok</button>
		</div>
	</dialog>


	<dialog class="mdl-dialog" id="msg-dialog">
		<h4 class="mdl-dialog__title" id="msg-title"></h4>
		<div class="mdl-dialog__content" style="width:100%;">
		   <div class="mdl-textfield mdl-js-textfield">
			<p id="msg-content"></p>	
			</div>
		</div>
		<div class="mdl-dialog__actions">
		  <button id="msg-close" type="button" class="mdl-button">Ok</button>
		</div>
	</dialog>


      <div id="create-note-btn" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-color-text--white"><i class="material-icons">
		edit
		</i> Add Note</div>
   

	<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-database.js"></script>
 
	<script>


var boardURLName="";
var notesID="";
var boardID="";
	  
	  var firebaseConfig = {
		apiKey: "AIzaSyBEF1Zrj8_c9SY_RbQOFrECE-pHykKqSxQ",
		authDomain: "uttr-app.firebaseapp.com",
		databaseURL: "https://uttr-app.firebaseio.com",
		projectId: "uttr-app",
		storageBucket: "uttr-app.appspot.com",
		messagingSenderId: "689608810939",
		appId: "1:689608810939:web:1928bfcad122206713a49e"
	  };

	 
	  firebase.initializeApp(firebaseConfig);
	  var database = firebase.database();

	  var provider = new firebase.auth.GoogleAuthProvider();
	  var token;
	  var user;
	  var author;
	  var userNotes=[];

	  function signIn(){		
		firebase.auth().signInWithPopup(provider).then(function(result) {		
		  token = result.credential.accessToken;		
		  user = result.user;
		  author = user.email;
		}).catch(function(error) {
		var errorCode = error.code;
		var errorMessage = error.message;
		var email = error.email;
		var credential = error.credential;
		console.log(errorCode,errorMessage);
		});
	  }

	  firebase.auth().onAuthStateChanged(function(userdata) {
		if (userdata) {			
			var displayName = userdata.displayName;
			var email = userdata.email;
			var emailVerified = userdata.emailVerified;
			var photoURL = userdata.photoURL;
			var isAnonymous = userdata.isAnonymous;
			var uid = userdata.uid;
			var providerData = userdata.providerData;
			author = email;		
			user=userdata;	
			document.getElementById("author-name").innerText = author;		
			document.getElementById("signInBtn").style.display = "none";		
			document.getElementById("signOutBtn").style.display = "flex";		
			document.getElementById("themeBtn").style.display = "flex";		
			document.getElementById("settingsBtn").style.display = "flex";		
			document.getElementById("create-board-btn").style.display = "block";
			document.getElementById("open-board-btn").style.display = "none";
			document.getElementById("save-board-btn").style.display = "none";
			document.getElementById("uttr-drawer-header-div").style.height = "110px";
			document.getElementById("boardList").innerHTML = "";
			document.getElementById("uttr-content").innerHTML = "";
			document.getElementById("currentBoardName").innerText = "Board 1";
			boardURLName="";
			userNotes=[];
			loadUserBoards();		
		} else {
			document.getElementById("author-name").innerText = "anonymous";
			document.getElementById("signInBtn").style.display = "flex";		
			document.getElementById("signOutBtn").style.display = "none";
			document.getElementById("themeBtn").style.display = "none";		
			document.getElementById("settingsBtn").style.display = "none";
			document.getElementById("create-board-btn").style.display = "none";	
			document.getElementById("open-board-btn").style.display = "block";
			document.getElementById("save-board-btn").style.display = "block";
			document.getElementById("boardList").innerHTML = "";	
			document.getElementById("uttr-content").innerHTML = "";	
			document.getElementById("currentBoardName").innerText = "Board 1"
			boardURLName="";
			userNotes=[];
			$("#searchBar").css("display","none");
			
		}
		});

	  function signOut(){
		firebase.auth().signOut().then(function() {
			user=null;
			userNotes=[];
			$("#searchBar").css("display","none");
		}).catch(function(error) {
			
		});
	  }


	  function search(searchText){
		$("#currentBoardName").css("display","none");
		$("#searchTitle").css("display","block");
		$("#boardRenameBtn").css("display","none");		
		document.getElementById("searchTitle").innerText = "Search ''" + searchText + "'";
		document.getElementById("uttr-content").innerHTML="";
		var titleResult = $.grep(userNotes, function(v,i) {			
			return v[0,1].title.toLowerCase().includes(searchText.toLowerCase());
		});

		var contentResult = $.grep(userNotes, function(v,i) {			
			return v[0,1].content.toLowerCase().includes(searchText.toLowerCase());
		});
		
		var result = titleResult.concat(contentResult).unique(); 
		console.log(result);
		result.forEach(function(item) {
			createNewNote(item[0], item[1].title, item[1].content,item[1].color, item[1].author, item[1].timestamp, item[2]);			
		});
		initiate();
		
		$("#create-note-btn").css("display","none");
	  }

	Array.prototype.unique = function() {
		var a = this.concat();
		for(var i=0; i<a.length; ++i) {
			for(var j=i+1; j<a.length; ++j) {
				if(a[i] === a[j])
					a.splice(j--, 1);
			}
		}

		return a;
	};

	  var parentVal;
	  function loadUserBoards(){
		if(user){
			$("#loader").css("display","block");
			var boardIndex=0;
			var noteIndex=0;
		
		firebase.database().ref('/boards/' + user.uid + '/').once('value', (snapshot) => {
			if (snapshot.exists()){			
				document.getElementById("uttr-content").innerHTML="";
				document.getElementById("boardList").innerHTML="";
				snapshot.forEach((child) => {
													
					firebase.database().ref('/boards/' + user.uid + '/' + child.key+'/').orderByChild('timestamp').on('value', (snapshot) => {
						
						if (snapshot.exists()){			
							document.getElementById("uttr-content").innerHTML="";
							snapshot.forEach((subchild) => {											
							 if(subchild.key=="boardName"){								
								 addBoardItem(subchild.val(),child.key);								
							 }else{
								 userNotes.push([subchild.key, subchild.val(), child.key]);
								 $("#searchBar").css("display","block");
							 }
							 noteIndex++;											
							}		
							);
							//boardURLName = name;
							
							initiate();
							$("#loader").css("display","none");
						}else{
							showMsg("Nope!","Board doesn't exists </br></br>Note: Please enter the board's unique URL only.");
							$("#loader").css("display","none");
						}
					});		
					boardIndex++			
				}		
				);
				boardURLName = "";
				document.getElementById("currentBoardName").innerHTML="Board 1";
				console.log("changed");
				
				initiate();
				$("#loader").css("display","none");
			}else{
				showMsg("Nope!","Board doesn't exists </br></br>Note: Please enter the board's unique URL only.");
				$("#loader").css("display","none");
			}
		});	
		}		
	  }
	  
	  function saveAnonymousBoard(name,msgFlag) {
		$("#loader").css("display","block");
		//Gather Data
		var JSONString="";
		var notes = document.getElementsByClassName("uttr-notes");

		if(!user){
			firebase.database().ref('boards/anonymous/' + name + "/").update({
					boardName: document.getElementById("currentBoardName").innerText
			}, function(error) {
					if (error) {
						if(msgFlag){
							showMsg("Failed!","Error in saving your board. This might occur due to no internet connection or failure on our end. Please report this error to support@uttr.in immediately /n Error Description: " + error)
							$("#loader").css("display","none");
						}
					} else {
						if(msgFlag){
							showMsg("Board Saved!","Your board has been saved. You can access your board via the link : </br></br> <span style='color:#0168c1;cursor:pointer;text-decoration:underline'>https://uttr.in/?b=" + name + "</span>")
							$("#loader").css("display","none");
						}
					}
			});
			$("#loader").css("display","none");
			for (i=0 ; i<notes.length; i++){			
				firebase.database().ref('boards/anonymous/' + name + "/" + document.getElementsByClassName("uttr-notes")[i].getAttribute("data-noteid")).update({
				title: document.getElementsByClassName("uttr-notes")[i].getElementsByClassName("notes")[0].innerText,
				content: document.getElementsByClassName("uttr-notes")[i].getElementsByClassName("notes")[1].innerText,			
				color: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-notecolor"),			
				timestamp: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-timestamp"),		
				author: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-author")			
				});			  
			}
		}else{
			firebase.database().ref('boards/' + user.uid + '/' + name + "/").update({
					boardName: document.getElementById("currentBoardName").innerText
			}, function(error) {
					if (error) {
						if(msgFlag){
							showMsg("Failed!","Error in saving your board. This might occur due to no internet connection or failure on our end. Please report this error to support@uttr.in immediately /n Error Description: " + error)
							$("#loader").css("display","none");
						}
					} else {
						if(msgFlag){
							showMsg("Board Saved!","Your board has been saved. You can access your board via the link : </br></br> <span style='color:#0168c1;cursor:pointer;text-decoration:underline'>https://uttr.in/?b=" + name + "</span>")
							$("#loader").css("display","none");
						}
					}
			});
			$("#loader").css("display","none");
			for (i=0 ; i<notes.length; i++){			
				firebase.database().ref('boards/' + user.uid + '/' + name + "/" + document.getElementsByClassName("uttr-notes")[i].getAttribute("data-noteid")).update({
				title: document.getElementsByClassName("uttr-notes")[i].getElementsByClassName("notes")[0].innerText,
				content: document.getElementsByClassName("uttr-notes")[i].getElementsByClassName("notes")[1].innerText,			
				color: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-notecolor"),			
				timestamp: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-timestamp"),		
				author: document.getElementsByClassName("uttr-notes")[i].getAttribute("data-author")			
				});			  
			}
		}
		 
	}

	function ifBoardExists(boardID){
		var toReturn; 
		$(".board-item").each(function(){
			
			if($(this).attr('data-boardid')==boardID){	
				toReturn = true;			
				return false;
			}
		});
		return toReturn; 
		
	}

	
	function selectBoard(boardID){
		var toReturn; 
		$(".board-item").each(function(){
			
			if($(this).attr('data-boardid')==boardID){	
				$(this).attr('data-selected',"true");				
			}else{
				$(this).attr('data-selected',"false");
			}
		});
		return toReturn; 
		
	}

	function renameBoard(boardID, newText){
		var toReturn; 
		$(".board-item").each(function(){
			
			if($(this).attr('data-boardid')==boardID){	
				$(this).html('<i class="mdl-color-text--white-800 material-icons" role="presentation">dashboard</i>' + newText);				
			}
		});
		return toReturn; 
		
	}

	function deleteBoardItem(boardID){
		$(".board-item").each(function(){
			
			if($(this).attr('data-boardid')==boardID){	
				$(this).remove();			
				return false;
			}
		});
	}

	function addBoardItem(boardname, boardID){		

		if(!(ifBoardExists(boardID))){

			var boardItem = document.createElement("DIV");
			boardItem.className = "mdl-navigation__link board-item";
			boardItem.setAttribute("data-boardname",boardname);
			boardItem.setAttribute("data-boardid",boardID);
			boardItem.style.cursor="pointer";
			boardItem.innerHTML = '<i class="mdl-color-text--white-800 material-icons" role="presentation">dashboard</i>' + boardname + '</a>';
			boardItem.addEventListener('click', function() {
				openAnonymousBoard(boardID);
				selectBoard(boardID);
				boardURLName = boardID;
			});

			document.getElementById("boardList").appendChild(boardItem);
		}
	}

	function openAnonymousBoard(name){
		$("#loader").css("display","block");
		

		
		if(user){
			firebase.database().ref('/boards/' + user.uid + '/').child(name).orderByChild('timestamp').on('value', (snapshot) => {
				if (snapshot.exists()){			
					document.getElementById("uttr-content").innerHTML="";
					snapshot.forEach((child) => {
						if(child.key=="boardName"){
							document.getElementById("currentBoardName").innerText = child.val();
							//document.getElementById("board-list-0").innerHTML='<i class="mdl-color-text--white-800 material-icons" role="presentation">dashboard</i>' + child.val() + '</a>';
							//document.getElementById("board-list-0").style.display="block";
							addBoardItem(child.val(),name);
						}else{
							createNewNote(child.key, child.val().title, child.val().content,child.val().color, child.val().author, child.val().timestamp, name);
							
						}			
									
					}		
					);
					boardURLName = name;
					boardID = name;
					
					initiate();
					$("#loader").css("display","none");
				}else{
					showMsg("Nope!","Board doesn't exists </br></br>Note: You cannot open anonymous board while logged in.");
					$("#loader").css("display","none");
				}
			});	
		}else{
			firebase.database().ref('/boards/anonymous/').child(name).on('value', (snapshot) => {
			if (snapshot.exists()){			
				document.getElementById("uttr-content").innerHTML="";
				snapshot.forEach((child) => {
					if(child.key=="boardName"){
						document.getElementById("currentBoardName").innerText = child.val();
						//document.getElementById("board-list-0").innerHTML='<i class="mdl-color-text--white-800 material-icons" role="presentation">dashboard</i>' + child.val() + '</a>';
						//document.getElementById("board-list-0").style.display="block";
						addBoardItem(child.val(),name);
					}else{
						createNewNote(child.key, child.val().title, child.val().content,child.val().color, child.val().author, child.val().timestamp, name);
						
					}			
								
				}		
				);
				boardURLName = name;
				
				initiate();
				$("#loader").css("display","none");
			}else{
				boardStatus = "unavailable";
				showMsg("Nope!","Board doesn't exists </br></br>Note: Please enter the board's unique URL only.");
				$("#loader").css("display","none");
			}
		});
		}
		$("#currentBoardName").css("display","block");
		$("#searchTitle").css("display","none");
		$("#create-note-btn").css("display","block");
		$("#boardRenameBtn").css("display","block");

	}

	document.getElementById('delete-board-btn').addEventListener('click', function() {
		if(boardURLName==""){

		}else{
			var r = confirm("Do you want to delete this entire board with all notes? You can't undo this action.");
			if (r == true) {
			if(user){
				firebase.database().ref('boards/' + user.uid + '/' + boardURLName).remove();
				deleteBoardItem(boardURLName);
				editNoteDialog.close();
				boardURLName="";
				document.getElementById("currentBoardName").innerHTML = "Board 1";
				document.getElementById("uttr-content").innerHTML = "";
			}else{
				firebase.database().ref('boards/anonymous/' + boardURLName).remove();
				deleteBoardItem(boardURLName);
				editNoteDialog.close();
				boardURLName="";
				document.getElementById("currentBoardName").innerHTML = "Board 1";
				document.getElementById("uttr-content").innerHTML = "";
			}
				
			} 
		}
	});

	function showMsg(title, content){
		var msgDialog = document.getElementById('msg-dialog');
					
		if (! msgDialog.showModal) {
		dialogPolyfill.registerDialog(msgDialog);
		}			
												
		msgDialog.querySelector('#msg-close').addEventListener('click', function() {
			msgDialog.close();
		});

		document.getElementById("msg-title").innerHTML = title;
		document.getElementById("msg-content").style.width="100%";
		document.getElementById("msg-content").innerHTML = '<span style="width:100%">' + content + "</span>";

		msgDialog.showModal();	
	}

	function checkAnonymousBoardExists(boardName){
		firebase.database().ref('/boards/anonymous/').child(boardName).on('value', (snapshot) => {
			if (snapshot.exists()){
				
				return true;
			}else{
				
				return false;
			}
		});
	}

	  
	function makeid(length) {
		   var result           = '';
		   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		   var charactersLength = characters.length;
		   for ( var i = 0; i < length; i++ ) {
			  result += characters.charAt(Math.floor(Math.random() * charactersLength));
		   }
		   return result;
	} 
	  


	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
			vars[key] = value;
		});
		return vars;
	}

	boardURLName = getUrlVars()["b"];

	if(boardURLName){
		openAnonymousBoard(boardURLName);
	}
		
	  //===============================================
	  //	Create Board Dialog
	  //===============================================
    var createBoardDialog = document.getElementById('create-board-dialog');
    var createBoardDialogBtn = document.getElementById('create-board-btn');
    if (! createBoardDialog.showModal) {
      dialogPolyfill.registerDialog(createBoardDialog);
    }
    createBoardDialogBtn.addEventListener('click', function() {
      createBoardDialog.showModal();
    });
	
	createBoardDialog.querySelector('#create-board-create-btn').addEventListener('click', function() {
	if(user){
		var boardurl = makeid(10);		
		addBoardItem(document.getElementById("boardName").value,boardurl);
		document.getElementById("currentBoardName").innerText = document.getElementById("boardName").value;
		console.log(document.getElementById("boardName").value,boardurl);
		document.getElementById("uttr-content").innerHTML = "";
		saveAnonymousBoard(boardurl,false);	
		boardURLName = boardurl;
	}
      createBoardDialog.close();
	});
	

    createBoardDialog.querySelector('#create-board-close-btn').addEventListener('click', function() {
      createBoardDialog.close();
    });
	
	  //===============================================
	  //	Save Board Dialog
	  //===============================================
	  
	  document.getElementById("urlName").addEventListener("keyup", function(){
		document.getElementById("yoururlhere").innerHTML = document.getElementById("urlName").value;
		if(document.getElementById("urlName").value==""){
			document.getElementById("yoururlhere").innerHTML = "&lt; Your URL here &gt;"
		}
	  });

	  document.getElementById("search").addEventListener("keyup", function(){
		search(document.getElementById("search").value);
		
	  });
	  
	  

	  document.getElementById("moreAboutBtn").addEventListener("click", function(){
		showMsg('Uttr','Alpha v1.0.0 </br></br>Please send your bug report and feedback to <span style="color:#0168c1;cursor:pointer;text-decoration:underline">deebash2009@gmail.com</span> </br></br> Developed by D.Deebash, Â© 2019')		
	  });
	  
		var saveBoardDialog = document.getElementById('save-board-dialog');
		var saveBoardDialogBtn = document.getElementById('save-board-btn');
		if (! saveBoardDialog.showModal) {
		dialogPolyfill.registerDialog(saveBoardDialog);
		}
		saveBoardDialogBtn.addEventListener('click', function() {
		saveBoardDialog.showModal();
		});
		
		saveBoardDialog.querySelector('#save-board-close-btn').addEventListener('click', function() {
		saveBoardDialog.close();
		});
		
		saveBoardDialog.querySelector('#save-board-save-btn').addEventListener('click', function() {
			var a = document.getElementsByClassName("uttr-notes");
			if(a.length==0){
				alert("Please add atleast one note to save the board");
			}else{
				var regex = new RegExp("^[a-zA-Z,0-9]+$");
				if(regex.test(document.getElementById("urlName").value)) {
					saveAnonymousBoard(document.getElementById("urlName").value,true);
					saveBoardDialog.close();
					console.log("correct");
				}else {
					alert("Please use only alphabets and numbers. No special characters and spaces");
					console.log("false");
				}
			}

		
		});


	  //===============================================
	  //	Open Board Dialog
	  //===============================================
	  
	  document.getElementById("openurlName").addEventListener("keyup", function(){
		document.getElementById("toOpenURL").innerHTML = "https://uttr.in/?b=" + document.getElementById("openurlName").value;
		if(document.getElementById("openurlName").value==""){
			document.getElementById("toOpenURL").innerHTML = "https://uttr.in/?b=&lt;unique URL&gt;";
		}
	  });

	  
		var openBoardDialog = document.getElementById('open-board-dialog');
		var openBoardDialogBtn = document.getElementById('open-board-btn');
		if (! openBoardDialog.showModal) {
		dialogPolyfill.registerDialog(openBoardDialog);
		}
		openBoardDialogBtn.addEventListener('click', function() {
			openBoardDialog.showModal();
		});
		
		openBoardDialog.querySelector('#open-board-close-btn').addEventListener('click', function() {
		openBoardDialog.close();
		});
		
		openBoardDialog.querySelector('#open-board-open-btn').addEventListener('click', function() {
		
		openAnonymousBoard(document.getElementById("openurlName").value);
		openBoardDialog.close();
		initiate();
		});



	  //===============================================
	  //	Create New Note
	  //===============================================
	  
	var createNoteDialog = document.getElementById('create-note-dialog');
    var createNoteDialogBtn = document.getElementById('create-note-btn');
    if (! createNoteDialog.showModal) {
      dialogPolyfill.registerDialog(createNoteDialog);
    }
    createNoteDialogBtn.addEventListener('click', function() {
	  createNoteDialog.showModal();
	  var color = this.getAttribute("data-notecolor");
					setTimeout(function(){
						//document.getElementById('noteColor').value = "Yellow";
						selectNewNoteColor("Yellow");						
					},10);	
    });
	
    createNoteDialog.querySelector('#create-note-close-btn').addEventListener('click', function() {
      createNoteDialog.close();
    });
	
	createNoteDialog.querySelector('#create-note-create-btn').addEventListener('click', function() {
	
	  var title = document.getElementById("noteTitleTxt").value;
	  var content = document.getElementById("noteContentTxt").value;	
	  var notecolor = document.getElementById("noteColor").value;  




	  if(boardURLName==""){
		if(title==""){
				alert("Please enter title for the note.");
		  }else{
			  if(user){
				createNewNote(makeid(5), title,content, notecolor, user.email);	
			  }else{
				createNewNote(makeid(5), title,content, notecolor,"anonymous");
			  }
		
			createNoteDialog.close();		
		  }
	  }else{
		  if(title==""){
				alert("Please enter title for the note.");
		  }else{
			if(user){
				createNewNote(makeid(5), title,content, notecolor, user.email);	
			  }else{
				createNewNote(makeid(5), title,content, notecolor,"anonymous");
			  }
			saveAnonymousBoard(boardURLName,false);
			createNoteDialog.close();
		  }
		
	  }
	  initiate();

      
    });
	  
	function createNewNote(noteID, title, content, color, user, timestamp=new Date().toISOString(), boardID=""){
		//console.log(new Date().toISOString())
		var noteTitle = document.createElement("DIV");
		noteTitle.className = "mdl-card__supporting-text mdl-card--border notes";
		noteTitle.innerHTML = "<b>" + title + "</b>";
	  	var noteContent = document.createElement("DIV");
		noteContent.className = "mdl-card__supporting-text notes-text-color notes";
		noteContent.innerHTML = content;
		var noteDiv = document.createElement("DIV");
		noteDiv.className = "uttr-updates mdl-card mdl-shadow--2dp uttr-notes";
		noteDiv.setAttribute("data-noteid",noteID);
		noteDiv.id = "note-" + noteID;
		noteDiv.setAttribute("data-notecolor",color);
		noteDiv.setAttribute("data-timestamp",timestamp);
		noteDiv.setAttribute("data-author", user);				
		noteDiv.setAttribute("data-boardid", boardID);
		noteDiv.appendChild(noteTitle);
		noteDiv.appendChild(noteContent);
		var mainContent = document.getElementById("uttr-content");
		mainContent.appendChild(noteDiv);
	}


	
	  //===============================================
	  //	Board Rename Dialog
	  //===============================================
	  
	var boardRenameDialog = document.getElementById('rename-board-dialog');
    var boardRenameBtn = document.getElementById('boardRenameBtn');
    if (! boardRenameDialog.showModal) {
      dialogPolyfill.registerDialog(boardRenameDialog);
    }
    boardRenameBtn.addEventListener('click', function() {
		
		boardRenameDialog.showModal();
		document.getElementById("boardNameTxt").value = document.getElementById("currentBoardName").innerHTML;
    });
	
    boardRenameDialog.querySelector('#rename-board-close-btn').addEventListener('click', function() {
		boardRenameDialog.close();
    });
	
	boardRenameDialog.querySelector('#rename-board-rename-btn').addEventListener('click', function() {
	
	  var name = document.getElementById("boardNameTxt").value;
	  renameBoard(boardURLName,name);
	 
	  if(boardURLName==""){
			document.getElementById("currentBoardName").innerHTML = name;
	  }else{
		  if(user){
			firebase.database().ref('/boards/' + user.uid + '/').child(boardURLName).on('value', (snapshot) => {
				if (snapshot.exists()){
					firebase.database().ref('boards/' + user.uid + '/' + boardURLName + "/").update({
					boardName: name
					});
					document.getElementById("currentBoardName").innerHTML = name;
				}else{
					document.getElementById("currentBoardName").innerHTML = name;
				}
			});
		  }else{
			firebase.database().ref('/boards/anonymous/').child(boardURLName).on('value', (snapshot) => {
				if (snapshot.exists()){
					firebase.database().ref('boards/anonymous/' + boardURLName + "/").update({
					boardName: name
					});
					document.getElementById("currentBoardName").innerHTML = name;
				}else{
					document.getElementById("currentBoardName").innerHTML = name;
				}
	 		});
		  }
		
	  }


	 
      boardRenameDialog.close();
	});
	

function selectColor(color){
	$("#editColorMDLSelect .note-color-item").each(function() {
    var currentElement = $(this);
	var value = currentElement.html(); 
	if(value==color){
		$(this).attr("data-selected","true");
	}else{
		$(this).removeAttr("data-selected");
	}  
	});

	getmdlSelect.init(".getmdl-select");

}

function selectNewNoteColor(color){
	$("#newColorMDLSelect .new-note-color-item").each(function() {
    var currentElement = $(this);
	var value = currentElement.html(); 
	if(value==color){
		$(this).attr("data-selected","true");
	}else{
		$(this).removeAttr("data-selected");
	}  
	});

	getmdlSelect.init(".getmdl-select");

}

	  //===============================================
	  //	Edit Note Dialog
	  //===============================================
var editNotes;

	function initiate(){
		
		editNotes = document.getElementsByClassName('uttr-notes');
		
		setTimeout(function(){
		

			for(var i = 0; i < editNotes.length; i++) {
				
				editNotes[i].addEventListener("click", function(e) {
					editNoteDialog.showModal();
					notesID = this.getAttribute("data-noteid");						
					boardID = this.getAttribute("data-boardid");						
					editNoteDialog.querySelector('#editNoteTitleTxt').value=this.getElementsByClassName("notes")[0].innerText;
					var content = this.getElementsByClassName("notes")[1].innerHTML;
					console.log("Content",content);			
					//editNoteDialog.querySelector('#editNoteContentTxt').value= $("#editNoteContentTxt").jqteVal(content);					
					$("#editNoteContentTxt").jqteVal(content);					
					var color = this.getAttribute("data-notecolor");
					var author = this.getAttribute("data-author");
					var timestamp = this.getAttribute("data-timestamp");
					
					setTimeout(function(){
						var offset = moment().utcOffset();
						//document.getElementById('editNoteColor').value = color;
						//document.getElementById('editNoteColorTxt').value = color;
						selectColor(color);						
						document.getElementById('note-meta').innerHTML = "Created by " + author + " on " +  moment.utc(timestamp).utcOffset(offset).format("LT, Do MMM YYYY");
					},10);		
				})
			}

			
		}, 500);

		
	}

	$("#editNoteContentTxt").jqte();
	$("#noteContentTxt").jqte();
	

	var editNoteDialog = document.getElementById('edit-dialog');
   
    if (! editNoteDialog.showModal) {
      dialogPolyfill.registerDialog(editNoteDialog);
    }    
	
    editNoteDialog.querySelector('#edit-cancel-btn').addEventListener('click', function() {
		editNoteDialog.close();
	});

	editNoteDialog.querySelector('#edit-delete-btn').addEventListener('click', function() {
		var r = confirm("Do you want to delete this note? You can't undo this action.");
		if (r == true) {
			if(user){				
				firebase.database().ref('boards/' + user.uid + '/' + boardID + "/" + notesID).remove();
				editNoteDialog.close();
			}else{
				firebase.database().ref('boards/anonymous/' + boardID + "/" + notesID).remove();
				editNoteDialog.close();
			}
		} 
		
	});

	editNoteDialog.querySelector('#edit-save-btn').addEventListener('click', function() {
		if(boardURLName==""){
			editNoteDialog.close();
		}else{
			if(user){
				firebase.database().ref('boards/' + user.uid + '/' + boardID + "/" + notesID).update({
				title: document.getElementById("editNoteTitleTxt").value,
				content: document.getElementById("editNoteContentTxt").value,			
				color: document.getElementById("editNoteColor").value		
				});	
				document.getElementById("note-"+notesID).setAttribute("data-notecolor", document.getElementById("editNoteColor").value)
				editNoteDialog.close();
			}else{
				firebase.database().ref('boards/anonymous/' + boardID + "/" + notesID).update({
				title: document.getElementById("editNoteTitleTxt").value,
				content: document.getElementById("editNoteContentTxt").value,			
				color: document.getElementById("editNoteColor").value		
				});	
				document.getElementById("note-"+notesID).setAttribute("data-notecolor", document.getElementById("editNoteColor").value)
				editNoteDialog.close();
			}
			
		}

	});

		
		$(document).ready(function() {
            $('.tooltip').tooltipster({
				theme: 'tooltipster-noir'
			});
        });


	
  </script>



  
  </body>
 
 
